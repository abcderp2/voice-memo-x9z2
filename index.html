<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="referrer" content="no-referrer">

<title>Final Audio Player</title>
<style>
  body { background: #111; color: white; font-family: sans-serif; padding: 20px; text-align: center; }
  textarea { width: 100%; height: 100px; font-size: 16px; padding: 10px; margin-bottom: 20px; }
  
  button {
    width: 100%; padding: 20px; font-size: 18px; font-weight: bold;
    color: white; border: none; border-radius: 10px; margin-bottom: 10px; cursor: pointer;
  }
  
  #btn-play { background: #007aff; }
  #btn-force { background: #ff9500; display: none; /* æœ€åˆã¯éš ã—ã¦ãŠã */ }
  
  #status { color: #ffcc00; margin-top: 10px; min-height: 20px; }
</style>
</head>
<body>

<h3>æœ€çµ‚æ‰‹æ®µãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</h3>
<textarea id="txt">ãƒ†ã‚¹ãƒˆã§ã™ã€‚èº«å…ƒã‚’éš ã—ã¦å†ç”Ÿã—ã¾ã™ã€‚</textarea>

<button id="btn-play" onclick="tryPlay()">â‘  ãã®å ´ã§å†ç”Ÿ</button>
<button id="btn-force" onclick="forcePlay()">â‘¡ æ–°ã—ã„ã‚¿ãƒ–ã§å†ç”Ÿ (å¼·åŠ›)</button>

<div id="status"></div>

<script>
  function getUrl() {
    const text = document.getElementById('txt').value;
    // Googleç¿»è¨³API (client=tw-ob ã¯ä¸€èˆ¬å…¬é–‹ç”¨)
    return `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodeURIComponent(text)}&tl=ja&client=tw-ob`;
  }

  function tryPlay() {
    const status = document.getElementById('status');
    const btnForce = document.getElementById('btn-force');
    const url = getUrl();

    status.textContent = "æ¥ç¶šä¸­...";

    const audio = new Audio(url);
    
    // å†ç”ŸæˆåŠŸæ™‚
    audio.onplay = () => {
      status.textContent = "ğŸ”Š å†ç”ŸæˆåŠŸï¼";
    };

    // å¤±æ•—æ™‚ï¼ˆãƒ–ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸæ™‚ï¼‰
    audio.onerror = (e) => {
      status.textContent = "âŒ ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚ã€Œãƒœã‚¿ãƒ³â‘¡ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ï¼";
      // å¤±æ•—ã—ãŸã‚‰ã€Œå¼·åˆ¶å†ç”Ÿãƒœã‚¿ãƒ³ã€ã‚’è¡¨ç¤ºã™ã‚‹
      btnForce.style.display = "block"; 
      alert("ã“ã®ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã§ã¯ç›´æ¥å†ç”Ÿã§ãã¾ã›ã‚“ã§ã—ãŸã€‚\næ–°ã—ãå‡ºãŸã€Œã‚ªãƒ¬ãƒ³ã‚¸è‰²ã®ãƒœã‚¿ãƒ³ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚");
    };

    // å†ç”Ÿå®Ÿè¡Œ
    audio.play().catch(e => {
      status.textContent = "âŒ æ¨©é™ã‚¨ãƒ©ãƒ¼ã€‚ã€Œãƒœã‚¿ãƒ³â‘¡ã€ã‚’ä½¿ã£ã¦ãã ã•ã„ã€‚";
      btnForce.style.display = "block";
    });
  }

  function forcePlay() {
    // æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ãï¼ˆã“ã‚Œã¯ãƒ–ãƒ©ã‚¦ã‚¶ã‚‚ãƒ–ãƒ­ãƒƒã‚¯ã§ããªã„ï¼‰
    const url = getUrl();
    window.open(url, '_blank');
  }
</script>

</body>
</html>
